<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Indian Cattle Breed Detection</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #4CAF50;
            --primary-dark: #388E3C;
            --secondary: #FF9800;
            --secondary-dark: #F57C00;
            --light: #f5f5f5;
            --dark: #333;
            --gray: #777;
            --white: #ffffff;
            --history-bg: #f0f7ff;
            --card-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        body {
            background: linear-gradient(135deg, #f9f9f9 0%, #e8f5e9 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: var(--white);
            padding: 25px 0;
            text-align: center;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 60%);
            transform: rotate(30deg);
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.95;
            max-width: 600px;
            margin: 0 auto;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 30px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            border: 2px solid transparent;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .nav-tab.active {
            background: var(--white);
            color: var(--primary);
            border-color: var(--primary);
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 40px;
        }

        .upload-section, .result-section {
            flex: 1;
            min-width: 300px;
            background: var(--white);
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s ease;
        }

        .upload-section:hover, .result-section:hover {
            transform: translateY(-5px);
        }

        .history-section, .stats-section {
            display: none;
            background: var(--white);
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .section-title i {
            margin-right: 10px;
        }

        .upload-area {
            border: 2px dashed var(--primary);
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .upload-area:hover {
            background-color: #f0fff0;
            border-color: var(--primary-dark);
        }

        .upload-area.active {
            background-color: #e8f5e9;
            border-color: var(--secondary);
        }

        .upload-icon {
            font-size: 3.5rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .preview-container {
            width: 100%;
            margin: 20px 0;
            display: none;
            text-align: center;
        }

        #imagePreview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: var(--white);
            border: none;
            padding: 14px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
            width: 100%;
            margin-top: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .btn:hover {
            background: linear-gradient(to right, var(--primary-dark), var(--primary));
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(to right, var(--secondary), var(--secondary-dark));
        }

        .btn-secondary:hover {
            background: linear-gradient(to right, var(--secondary-dark), var(--secondary));
        }

        .btn i {
            margin-right: 8px;
        }

        .btn-sm {
            width: auto;
            padding: 8px 16px;
            font-size: 0.9rem;
            margin-top: 0;
        }

        .result-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .breed-card {
            background: linear-gradient(to bottom right, #f9f9f9, #e8f5e9);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--primary);
            position: relative;
        }

        .breed-actions {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px;
        }

        .breed-name {
            font-size: 1.8rem;
            color: var(--primary-dark);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .breed-name i {
            margin-right: 10px;
        }

        .confidence {
            display: inline-block;
            background-color: #E8F5E9;
            color: var(--primary-dark);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .breed-info {
            margin-top: 15px;
        }

        .info-item {
            margin-bottom: 10px;
            display: flex;
            align-items: flex-start;
        }

        .info-label {
            font-weight: bold;
            display: inline-block;
            width: 160px;
            color: var(--primary-dark);
        }

        .sample-images {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            overflow-x: auto;
            padding-bottom: 15px;
        }

        .sample-img {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            object-fit: cover;
            border: 2px solid #ddd;
            transition: transform 0.3s;
            cursor: pointer;
        }

        .sample-img:hover {
            transform: scale(1.05);
            border-color: var(--primary);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .breed-characteristics {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 3px solid var(--secondary);
        }

        .disease-management {
            background-color: #fff3e0;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 3px solid var(--secondary-dark);
        }

        .history-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .history-item {
            background: var(--history-bg);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
            cursor: pointer;
        }

        .history-item:hover {
            transform: translateY(-3px);
        }

        .history-img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .history-breed {
            font-weight: bold;
            color: var(--primary-dark);
            margin-bottom: 5px;
        }

        .history-date {
            font-size: 0.8rem;
            color: var(--gray);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
            margin: 10px 0;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--gray);
        }

        .favorite {
            color: #ff4757;
        }

        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: var(--gray);
            font-size: 0.9rem;
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
        }

        .featured-breeds {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 30px 0;
            justify-content: center;
        }

        .featured-breed {
            background: var(--white);
            border-radius: 8px;
            overflow: hidden;
            width: 180px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
            cursor: pointer;
        }

        .featured-breed:hover {
            transform: translateY(-5px);
        }

        .featured-breed img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .featured-breed p {
            padding: 10px;
            text-align: center;
            font-weight: 600;
            color: var(--primary-dark);
        }

        .api-status {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-connected {
            background-color: var(--primary);
        }

        .status-disconnected {
            background-color: #f44336;
        }

        .ai-response {
            background-color: #e3f2fd;
            border-radius: 8px;
            padding: 15px;
            padding-left: 20px;
            margin: 15px 0;
            border-left: 3px solid #2196f3;
            white-space: pre-wrap;
        }

        .clear-history {
            background: #ff4757;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .clear-history:hover {
            background: #ff3742;
        }

        /* Responsive improvements */
        @media (max-width: 1200px) {
            .container {
                padding: 15px;
            }
            
            .main-content {
                gap: 20px;
            }
        }

        @media (max-width: 992px) {
            h1 {
                font-size: 2.4rem;
            }
            
            .featured-breed {
                width: 150px;
            }
            
            .featured-breed img {
                height: 100px;
            }
            
            .section-title {
                font-size: 1.3rem;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }

            h1 {
                font-size: 2rem;
            }
            
            .subtitle {
                font-size: 1rem;
                padding: 0 10px;
            }

            .info-item {
                flex-direction: column;
            }

            .info-label {
                width: 100%;
                margin-bottom: 5px;
            }

            .history-items {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tab {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .upload-section, .result-section {
                padding: 20px;
            }
            
            .breed-name {
                font-size: 1.5rem;
            }
            
            .breed-actions {
                position: relative;
                top: 0;
                right: 0;
                margin-bottom: 15px;
                justify-content: flex-end;
            }
            
            .featured-breeds {
                gap: 15px;
            }
            
            .featured-breed {
                width: calc(50% - 15px);
                max-width: 180px;
            }
        }

        @media (max-width: 576px) {
            h1 {
                font-size: 1.8rem;
            }
            
            header {
                padding: 20px 0;
                border-radius: 10px;
            }
            
            .nav-tabs {
                margin: 15px 0;
            }
            
            .upload-section, .result-section, .history-section, .stats-section {
                padding: 15px;
                border-radius: 10px;
            }
            
            .upload-area {
                padding: 30px 15px;
            }
            
            .upload-icon {
                font-size: 2.5rem;
            }
            
            .section-title {
                font-size: 1.2rem;
            }
            
            .btn {
                padding: 12px 16px;
                font-size: 0.95rem;
            }
            
            .featured-breed {
                width: calc(50% - 10px);
            }
            
            .featured-breed p {
                font-size: 0.9rem;
            }
            
            .sample-images {
                gap: 10px;
            }
            
            .sample-img {
                width: 80px;
                height: 80px;
            }
            
            .stat-value {
                font-size: 2rem;
            }
        }

        @media (max-width: 400px) {
            h1 {
                font-size: 1.6rem;
            }
            
            .nav-tab {
                padding: 8px 12px;
                font-size: 0.85rem;
            }
            
            .featured-breed {
                width: 100%;
                max-width: 160px;
            }
            
            .breed-name {
                font-size: 1.3rem;
            }
        }

        /* Mobile menu for very small screens */
        @media (max-width: 360px) {
            .nav-tabs {
                flex-direction: column;
                width: 100%;
            }
            
            .nav-tab {
                width: 100%;
                text-align: center;
            }
            
            .featured-breed {
                max-width: none;
            }
        }

        /* Animation improvements */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        .slide-in {
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-cow"></i> Indian Cattle Breed Detection</h1>
            <p class="subtitle">AI-powered identification of cattle and buffalo breeds with detailed information</p>
            <div class="api-status">
                <div class="status-indicator status-connected"></div>
                <span>Connected to Gemini AI</span>
            </div>
        </header>

        <div class="nav-tabs">
            <div class="nav-tab active" data-tab="detection"><i class="fas fa-camera"></i> Detection</div>
            <div class="nav-tab" data-tab="history"><i class="fas fa-history"></i> History</div>
            <div class="nav-tab" data-tab="stats"><i class="fas fa-chart-bar"></i> Statistics</div>
        </div>

        <div class="featured-breeds">
            <div class="featured-breed" data-breed="sahiwal">
                <img src="./assets/sahiwal.jpg"
                    alt="Sahiwal">
                <p>Sahiwal</p>
            </div>
            <div class="featured-breed" data-breed="gir">
                <img src="./assets/gir.jpg"
                    alt="Gir">
                <p>Gir</p>
            </div>
            <div class="featured-breed" data-breed="murrah">
                <img src="./assets/murrah.jpg"
                    alt="Murrah">
                <p>Murrah</p>
            </div>
            <div class="featured-breed" data-breed="tharparkar">
                <img src="./assets/tharparkar.jpg"
                    alt="Tharparkar">
                <p>Tharparkar</p>
            </div>
        </div>

        <div class="detection-content">
            <div class="main-content">
                <div class="upload-section">
                    <h2 class="section-title"><i class="fas fa-upload"></i> Upload Cattle Image</h2>
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
                        <p>Click or drag an image here to upload</p>
                        <p class="small">Supported formats: JPG, PNG, JPEG</p>
                        <input type="file" id="fileInput" class="file-input" accept="image/*">
                    </div>

                    <div class="preview-container" id="previewContainer">
                        <img id="imagePreview" src="" alt="Preview">
                    </div>

                    <button class="btn" id="detectBtn"><i class="fas fa-search"></i> Detect Breed</button>

                    <div class="loading" id="loadingIndicator">
                        <div class="loading-spinner"></div>
                        <p>Analyzing image with Gemini AI...</p>
                    </div>

                    <h3 class="section-title"><i class="fas fa-images"></i> Sample Images</h3>
                    <div class="sample-images">
                        <img src="./assets/sahiwal.jpg"
                            alt="Sahiwal sample" class="sample-img">
                        <img src="./assets/gir.jpg"
                            alt="Gir sample" class="sample-img">
                        <img src="./assets/murrah.jpg"
                            alt="Murrah sample" class="sample-img">
                        <img src="./assets/tharparkar.jpg"
                            alt="Tharparkar sample" class="sample-img">
                    </div>
                </div>

                <div class="result-section">
                    <h2 class="section-title"><i class="fas fa-results"></i> Detection Results</h2>
                    <div id="placeholderResult">
                        <p>Upload an image and click "Detect Breed" to see results here.</p>
                        <p>You can also click on any breed image to see sample information.</p>
                    </div>

                    <div class="result-content" id="resultContent">
                        <div class="breed-card">
                            <div class="breed-actions">
                                <button class="btn btn-sm" id="favoriteBtn" title="Add to favorites"><i class="far fa-star"></i></button>
                                <button class="btn btn-sm btn-secondary" id="exportBtn" title="Export data"><i class="fas fa-download"></i></button>
                            </div>
                            <h3 class="breed-name"><i class="fas fa-cow"></i> <span id="breedName">Breed Name</span></h3>
                            <span class="confidence" id="confidenceLevel">Confidence level</span>

                            <div class="breed-info">
                                <div class="info-item">
                                    <span class="info-label">Origin:</span>
                                    <span id="origin">Origin information will appear here</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Local Name:</span>
                                    <span id="localName">Local name will appear here</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Milk Yield:</span>
                                    <span id="milkYield">Milk yield information will appear here</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Lactation Period:</span>
                                    <span id="lactationPeriod">Lactation period will appear here</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Common Diseases:</span>
                                    <span id="diseases">Common diseases will appear here</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Nutrition Demand:</span>
                                    <span id="nutrition">Nutrition information will appear here</span>
                                </div>
                            </div>
                        </div>

                        <h3 class="section-title"><i class="fas fa-list"></i> Breed Characteristics</h3>
                        <div class="breed-characteristics">
                            <p id="characteristics">Breed characteristics will appear here</p>
                        </div>

                        <h3 class="section-title"><i class="fas fa-heartbeat"></i> Disease Management</h3>
                        <div class="disease-management">
                            <p id="diseaseManagement">Disease management information will appear here</p>
                        </div>

                        <h3 class="section-title"><i class="fas fa-robot"></i> AI Analysis</h3>
                        <div class="ai-response">
                            <p id="aiAnalysis">Gemini AI analysis will appear here after processing the image.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="history-section" id="historySection">
            <h2 class="section-title">
                <span><i class="fas fa-history"></i> Detection History</span>
                <button class="clear-history" id="clearHistoryBtn"><i class="fas fa-trash"></i> Clear History</button>
            </h2>
            <div class="history-items" id="historyItems">
                <!-- History items will be populated by JavaScript -->
            </div>
        </div>

        <div class="stats-section" id="statsSection">
            <h2 class="section-title"><i class="fas fa-chart-bar"></i> Usage Statistics</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <i class="fas fa-camera fa-2x"></i>
                    <div class="stat-value" id="totalDetections">0</div>
                    <div class="stat-label">Total Detections</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-star fa-2x"></i>
                    <div class="stat-value" id="favoriteCount">0</div>
                    <div class="stat-label">Favorites</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-cow fa-2x"></i>
                    <div class="stat-value" id="uniqueBreeds">0</div>
                    <div class="stat-label">Unique Breeds</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-calendar fa-2x"></i>
                    <div class="stat-value" id="lastDetection">-</div>
                    <div class="stat-label">Last Detection</div>
                </div>
            </div>
        </div>

        <footer>
            <p>This application uses Google's Gemini AI technology to identify Indian cattle and buffalo breeds based on
                image analysis.</p>
            <p>© 2023 Indian Cattle Breed Detection | <i class="fas fa-heart" style="color: #e91e63;"></i> Made with
                care for farmers</p>
        </footer>
    </div>

    <script>
        // JavaScript remains exactly the same as in the original code
        document.addEventListener('DOMContentLoaded', function () {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const detectBtn = document.getElementById('detectBtn');
            const placeholderResult = document.getElementById('placeholderResult');
            const resultContent = document.getElementById('resultContent');
            const previewContainer = document.getElementById('previewContainer');
            const imagePreview = document.getElementById('imagePreview');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const favoriteBtn = document.getElementById('favoriteBtn');
            const exportBtn = document.getElementById('exportBtn');
            const historySection = document.getElementById('historySection');
            const historyItems = document.getElementById('historyItems');
            const statsSection = document.getElementById('statsSection');
            const clearHistoryBtn = document.getElementById('clearHistoryBtn');
            const navTabs = document.querySelectorAll('.nav-tab');
            const apiKey = 'AIzaSyDrn9EfZyRztCrCaxOoqWyRDio32eDJX7o';

            // Initialize data storage
            let detectionHistory = JSON.parse(localStorage.getItem('detectionHistory')) || [];
            let favoriteDetections = JSON.parse(localStorage.getItem('favoriteDetections')) || [];
            let currentDetection = null;

            // Breed database
            const breedDatabase = {
                sahiwal: {
                    name: "Sahiwal",
                    confidence: "92%",
                    origin: "Montgomery district in Pakistan",
                    localName: "Montgomery, Lola, Multani, Teli",
                    milkYield: "2725-3125 kg per lactation",
                    lactationPeriod: "300 days",
                    diseases: "Mastitis, foot rot, respiratory infections",
                    nutrition: "High-quality forage with grain supplementation",
                    characteristics: "Sahiwal is considered the best Indian dairy breed. The color is reddish dun or pale red, often mixed with white patches. Horns are short and stumpy, measuring about 3 inches. They possess large and heavy dewlap and massive hump (males).",
                    diseaseManagement: "Effective disease and pest management, along with vaccination protocols, are crucial for maintaining the health and productivity of Sahiwal cows. Common vaccines include those for diseases such as bovine viral diarrhea (BVD), infectious bovine rhinotracheitis (IBR), bovine respiratory syncytial virus (BRSV), leptospirosis, and clostridial infections."
                },
                gir: {
                    name: "Gir",
                    confidence: "88%",
                    origin: "Gir forests of South Kathiawar in Gujarat",
                    localName: "Kathiawari, Surti, Desan",
                    milkYield: "1800-3000 kg per lactation",
                    lactationPeriod: "280 days",
                    diseases: "Tick fever, mastitis, foot and mouth disease",
                    nutrition: "Requires green fodder and protein-rich supplements",
                    characteristics: "The Gir is distinctive with its convex forehead, long pendulous ears, and folded horns. The color is shining red to spotted white. It is known for its tolerance to stress conditions and resistance to various tropical diseases.",
                    diseaseManagement: "Regular deworming and vaccination against hemorrhagic septicemia, black quarter, and foot and mouth disease are essential. Proper tick control measures should be implemented to prevent tick fever."
                },
                murrah: {
                    name: "Murrah",
                    confidence: "95%",
                    origin: "Rohtak, Hisar, and Jind of Haryana",
                    localName: "Delhi, Kundi, Kali",
                    milkYield: "1800-2500 kg per lactation",
                    lactationPeriod: "310 days",
                    diseases: "Mastitis, milk fever, parasitic infections",
                    nutrition: "Requires abundant green fodder and mineral mixtures",
                    characteristics: "The Murrah buffalo is jet black in color, sometimes with white markings on the face and legs. The horns are tight, curved, and spiral. The body is compact with a short neck and a long, narrow face.",
                    diseaseManagement: "Regular vaccination against foot and mouth disease and hemorrhagic septicemia is necessary. Proper hygiene during milking prevents mastitis. Calcium supplementation helps prevent milk fever."
                },
                tharparkar: {
                    name: "Tharparkar",
                    confidence: "85%",
                    origin: "Tharparkar district in Sindh, Pakistan",
                    localName: "White Sindhi, Gray Sindhi, Thari",
                    milkYield: "2400-3000 kg per lactation",
                    lactationPeriod: "295 days",
                    diseases: "Parasitic infections, pneumonia, mastitis",
                    nutrition: "Adapted to poor quality forage, benefits from protein supplements",
                    characteristics: "The Tharparkar is medium-sized with white or light gray skin. The horns are lyre-shaped and directed upward. They are known for their hardiness and ability to thrive in arid conditions.",
                    diseaseManagement: "Regular deworming is essential in parasitic infections. Vaccination against foot and mouth disease and hemorrhagic septicemia is recommended. Proper shelter during extreme weather prevents pneumonia."
                }
            };

            // Initialize the app
            initApp();

            // Handle file upload
            uploadArea.addEventListener('click', function () {
                fileInput.click();
            });

            uploadArea.addEventListener('dragover', function (e) {
                e.preventDefault();
                uploadArea.classList.add('active');
            });

            uploadArea.addEventListener('dragleave', function () {
                uploadArea.classList.remove('active');
            });

            uploadArea.addEventListener('drop', function (e) {
                e.preventDefault();
                uploadArea.classList.remove('active');
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    handleFileUpload(fileInput.files[0]);
                }
            });

            fileInput.addEventListener('change', function () {
                if (fileInput.files.length) {
                    handleFileUpload(fileInput.files[0]);
                }
            });

            function handleFileUpload(file) {
                const reader = new FileReader();

                reader.onload = function (e) {
                    imagePreview.src = e.target.result;
                    previewContainer.style.display = 'block';
                }

                reader.readAsDataURL(file);
            }

            // Handle breed detection
            detectBtn.addEventListener('click', function () {
                if (!fileInput.files.length) {
                    alert('Please select an image first.');
                    return;
                }

                // Show loading state
                loadingIndicator.style.display = 'block';
                detectBtn.disabled = true;

                // Convert image to base64
                const reader = new FileReader();
                reader.readAsDataURL(fileInput.files[0]);
                reader.onload = function () {
                    const base64Data = reader.result.split(',')[1];

                    // Call Gemini API
                    callGeminiAPI(base64Data);
                };
            });

            // Call Gemini API
            async function callGeminiAPI(imageData) {
                try {
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const requestBody = {
                        contents: [{
                            parts: [
                                { text: "Analyze this image of an Indian cattle or buffalo. Identify the breed and provide information about its origin, characteristics, milk yield, common diseases, and nutrition requirements. Also estimate your confidence level in this identification." },
                                {
                                    inline_data: {
                                        mime_type: "image/jpeg",
                                        data: imageData
                                    }
                                }
                            ]
                        }]
                    };

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestBody)
                    });

                    if (!response.ok) {
                        throw new Error(`API request failed with status ${response.status}`);
                    }

                    const data = await response.json();

                    // Process the response
                    const aiResponse = data.candidates[0].content.parts[0].text;

                    // Parse the AI response to extract breed information
                    const breedInfo = parseAIResponse(aiResponse);

                    // Add to detection history
                    currentDetection = {
                        id: Date.now(),
                        timestamp: new Date().toISOString(),
                        breed: breedInfo.name,
                        confidence: breedInfo.confidence,
                        imageData: imagePreview.src,
                        breedData: breedInfo,
                        aiResponse: aiResponse,
                        isFavorite: false
                    };

                    detectionHistory.unshift(currentDetection);
                    localStorage.setItem('detectionHistory', JSON.stringify(detectionHistory));

                    // Update UI
                    updateHistoryDisplay();
                    updateStatsDisplay();

                    // Display the results
                    displayBreedResult(breedInfo, aiResponse);

                } catch (error) {
                    console.error('Error calling Gemini API:', error);
                    alert('Failed to analyze image. Please try again later.');

                    // Fallback to demo mode
                    const breeds = Object.keys(breedDatabase);
                    const randomBreed = breeds[Math.floor(Math.random() * breeds.length)];
                    
                    // Create a demo detection
                    currentDetection = {
                        id: Date.now(),
                        timestamp: new Date().toISOString(),
                        breed: breedDatabase[randomBreed].name,
                        confidence: breedDatabase[randomBreed].confidence,
                        imageData: imagePreview.src,
                        breedData: breedDatabase[randomBreed],
                        aiResponse: "Gemini AI is experiencing high demand. Here's sample data for this breed.",
                        isFavorite: false
                    };

                    detectionHistory.unshift(currentDetection);
                    localStorage.setItem('detectionHistory', JSON.stringify(detectionHistory));
                    
                    // Update UI
                    updateHistoryDisplay();
                    updateStatsDisplay();
                    
                    displayBreedResult(breedDatabase[randomBreed], "Gemini AI is experiencing high demand. Here's sample data for this breed.");

                } finally {
                    // Hide loading indicator
                    loadingIndicator.style.display = 'none';
                    detectBtn.disabled = false;
                }
            }

            // Parse AI response to extract structured information
            function parseAIResponse(aiResponse) {
                // Default breed info structure
                const breedInfo = {
                    name: "Unknown Breed",
                    confidence: "Unknown",
                    origin: "Information not available",
                    localName: "Information not available",
                    milkYield: "Information not available",
                    lactationPeriod: "Information not available",
                    diseases: "Information not available",
                    nutrition: "Information not available",
                    characteristics: "Information not available",
                    diseaseManagement: "Information not available"
                };

                // Try to extract breed name
                const breedMatches = aiResponse.match(/(Sahiwal|Gir|Murrah|Tharparkar|Red Sindhi|Kankrej|Ongole|Hariana|Rathi|Deoni|Nili-Ravi|Jaffrabadi|Nagpuri)/i);
                if (breedMatches) {
                    breedInfo.name = breedMatches[0];
                }

                // Try to extract confidence level
                const confidenceMatch = aiResponse.match(/(\d+)% confidence/);
                if (confidenceMatch) {
                    breedInfo.confidence = confidenceMatch[0];
                } else {
                    breedInfo.confidence = "Moderate confidence";
                }

                // For demo purposes, if we detect a known breed, use our database info
                const breedKey = breedInfo.name.toLowerCase();
                if (breedDatabase[breedKey]) {
                    return {
                        ...breedDatabase[breedKey],
                        confidence: breedInfo.confidence
                    };
                }

                return breedInfo;
            }

            // Display breed result
            function displayBreedResult(breedData, aiAnalysis) {
                document.getElementById('breedName').textContent = breedData.name;
                document.getElementById('confidenceLevel').textContent = breedData.confidence + ' confidence';
                document.getElementById('origin').textContent = breedData.origin;
                document.getElementById('localName').textContent = breedData.localName;
                document.getElementById('milkYield').textContent = breedData.milkYield;
                document.getElementById('lactationPeriod').textContent = breedData.lactationPeriod;
                document.getElementById('diseases').textContent = breedData.diseases;
                document.getElementById('nutrition').textContent = breedData.nutrition;
                document.getElementById('characteristics').textContent = breedData.characteristics;
                document.getElementById('diseaseManagement').textContent = breedData.diseaseManagement;
                convertAndAppendHtml(aiAnalysis, 'aiAnalysis');

                // Update favorite button state
                updateFavoriteButton();

                // Show results
                placeholderResult.style.display = 'none';
                resultContent.style.display = 'block';

                // Scroll to results
                resultContent.scrollIntoView({ behavior: 'smooth' });
            }

            // Update favorite button state
            function updateFavoriteButton() {
                if (currentDetection) {
                    const isFavorite = favoriteDetections.some(d => d.id === currentDetection.id);
                    favoriteBtn.innerHTML = isFavorite ? 
                        '<i class="fas fa-star favorite"></i>' : 
                        '<i class="far fa-star"></i>';
                    favoriteBtn.title = isFavorite ? 'Remove from favorites' : 'Add to favorites';
                    
                    if (isFavorite) {
                        favoriteBtn.classList.add('favorite');
                    } else {
                        favoriteBtn.classList.remove('favorite');
                    }
                }
            }

            // Toggle favorite status
            favoriteBtn.addEventListener('click', function() {
                if (!currentDetection) return;
                
                const index = favoriteDetections.findIndex(d => d.id === currentDetection.id);
                
                if (index === -1) {
                    // Add to favorites
                    favoriteDetections.push(currentDetection);
                    currentDetection.isFavorite = true;
                    favoriteBtn.innerHTML = '<i class="fas fa-star favorite"></i>';
                    favoriteBtn.title = 'Remove from favorites';
                    favoriteBtn.classList.add('favorite');
                } else {
                    // Remove from favorites
                    favoriteDetections.splice(index, 1);
                    currentDetection.isFavorite = false;
                    favoriteBtn.innerHTML = '<i class="far fa-star"></i>';
                    favoriteBtn.title = 'Add to favorites';
                    favoriteBtn.classList.remove('favorite');
                }
                
                localStorage.setItem('favoriteDetections', JSON.stringify(favoriteDetections));
                updateStatsDisplay();
            });

            // Export data
            exportBtn.addEventListener('click', function() {
                if (!currentDetection) return;
                
                const dataStr = JSON.stringify(currentDetection, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `cattle_detection_${currentDetection.breed}_${new Date().toISOString().slice(0, 10)}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            });

            // Clear history
            clearHistoryBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to clear all detection history?')) {
                    detectionHistory = [];
                    favoriteDetections = [];
                    localStorage.removeItem('detectionHistory');
                    localStorage.removeItem('favoriteDetections');
                    updateHistoryDisplay();
                    updateStatsDisplay();
                }
            });

            // Navigation tabs
            navTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    // Update active tab
                    navTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show appropriate content
                    document.querySelector('.detection-content').style.display = tabName === 'detection' ? 'block' : 'none';
                    historySection.style.display = tabName === 'history' ? 'block' : 'none';
                    statsSection.style.display = tabName === 'stats' ? 'block' : 'none';
                    
                    // Update content if needed
                    if (tabName === 'history') updateHistoryDisplay();
                    if (tabName === 'stats') updateStatsDisplay();
                });
            });

            // Update history display
            function updateHistoryDisplay() {
                historyItems.innerHTML = '';
                
                if (detectionHistory.length === 0) {
                    historyItems.innerHTML = '<p>No detection history yet. Upload an image to get started!</p>';
                    return;
                }
                
                detectionHistory.forEach(detection => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.innerHTML = `
                        <img src="${detection.imageData}" alt="${detection.breed}" class="history-img">
                        <div class="history-breed">${detection.breed}</div>
                        <div class="history-confidence">${detection.confidence} confidence</div>
                        <div class="history-date">${new Date(detection.timestamp).toLocaleString()}</div>
                        ${detection.isFavorite ? '<i class="fas fa-star favorite" style="margin-top: 10px;"></i>' : ''}
                    `;
                    
                    historyItem.addEventListener('click', function() {
                        // Load this detection
                        currentDetection = detection;
                        displayBreedResult(detection.breedData, detection.aiResponse);
                        
                        // Switch to detection tab
                        navTabs.forEach(t => t.classList.remove('active'));
                        document.querySelector('[data-tab="detection"]').classList.add('active');
                        document.querySelector('.detection-content').style.display = 'block';
                        historySection.style.display = 'none';
                        statsSection.style.display = 'none';
                    });
                    
                    historyItems.appendChild(historyItem);
                });
            }

            // Update stats display
            function updateStatsDisplay() {
                document.getElementById('totalDetections').textContent = detectionHistory.length;
                document.getElementById('favoriteCount').textContent = favoriteDetections.length;
                
                // Count unique breeds
                const uniqueBreeds = new Set(detectionHistory.map(d => d.breed));
                document.getElementById('uniqueBreeds').textContent = uniqueBreeds.size;
                
                // Last detection date
                if (detectionHistory.length > 0) {
                    const lastDetection = new Date(detectionHistory[0].timestamp);
                    document.getElementById('lastDetection').textContent = lastDetection.toLocaleDateString();
                } else {
                    document.getElementById('lastDetection').textContent = '-';
                }
            }

            // Initialize the app
            function initApp() {
                updateHistoryDisplay();
                updateStatsDisplay();
                
                // Sample image click handler
                document.querySelectorAll('.sample-img, .featured-breed').forEach(item => {
                    item.addEventListener('click', function () {
                        const breed = this.alt.toLowerCase().replace(' sample', '').replace(' ', '') ||
                            this.getAttribute('data-breed');

                        if (breedDatabase[breed]) {
                            // Show loading state
                            loadingIndicator.style.display = 'block';

                            // Simulate API call for sample images
                            setTimeout(() => {
                                // Create a sample detection
                                currentDetection = {
                                    id: Date.now(),
                                    timestamp: new Date().toISOString(),
                                    breed: breedDatabase[breed].name,
                                    confidence: breedDatabase[breed].confidence,
                                    imageData: this.src,
                                    breedData: breedDatabase[breed],
                                    aiResponse: "Based on my analysis, this appears to be a " + breedDatabase[breed].name + " breed. " +
                                        "I'm " + breedDatabase[breed].confidence + " confident in this identification. " +
                                        "This breed is known for " + breedDatabase[breed].characteristics.substring(0, 100) + "...",
                                    isFavorite: false
                                };

                                // Add to history if it's a featured breed (not sample image)
                                if (this.classList.contains('featured-breed')) {
                                    detectionHistory.unshift(currentDetection);
                                    localStorage.setItem('detectionHistory', JSON.stringify(detectionHistory));
                                    updateHistoryDisplay();
                                    updateStatsDisplay();
                                }

                                displayBreedResult(
                                    breedDatabase[breed],
                                    "Based on my analysis, this appears to be a " + breedDatabase[breed].name + " breed. " +
                                    "I'm " + breedDatabase[breed].confidence + " confident in this identification. " +
                                    "This breed is known for " + breedDatabase[breed].characteristics.substring(0, 100) + "..."
                                );

                                loadingIndicator.style.display = 'none';
                            }, 1000);
                        }
                    });
                });
            }
        });

        function convertAndAppendHtml(rawText, elementId) {
            if (typeof rawText !== 'string') throw new TypeError('rawText must be a string');
            if (!elementId) throw new TypeError('elementId is required');

            // Escape HTML special chars (so user content won't inject HTML)
            function escapeHtml(s) {
                return s.replace(/[&<>"']/g, function (c) {
                    return { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[c];
                });
            }

            // Convert **bold** into <strong> safely (run after escaping)
            function convertBold(s) {
                return s.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            }

            const lines = rawText.replace(/\r\n/g, '\n').split('\n');
            let htmlParts = [];
            let listStack = []; // track current open <ul> levels (count)
            let inParagraph = false;

            function closeAllLists() {
                while (listStack.length) {
                    htmlParts.push('</ul>');
                    listStack.pop();
                }
            }
            function closeParagraph() {
                if (inParagraph) {
                    htmlParts.push('</p>');
                    inParagraph = false;
                }
            }

            for (let rawLine of lines) {
                // preserve original leading whitespace for nesting calculation, but trim trailing
                const trailingTrimmed = rawLine.replace(/\s+$/, '');
                // detect list item: optional leading spaces/tabs then '*' and a space
                const listMatch = trailingTrimmed.match(/^([\t ]*)(\*)\s+(.*)$/);
                if (listMatch) {
                    // It's a list item
                    const leading = listMatch[1].replace(/\t/g, '    '); // make tabs 4 spaces
                    const content = listMatch[3];
                    const level = Math.max(0, Math.floor(leading.length / 4)); // 4 spaces per nest

                    // close any open paragraph when starting a list
                    closeParagraph();

                    // open or close <ul> tags to reach correct level
                    while (listStack.length < level + 1) {
                        htmlParts.push('<ul>');
                        listStack.push(true);
                    }
                    while (listStack.length > level + 1) {
                        htmlParts.push('</ul>');
                        listStack.pop();
                    }

                    // produce the list item (escape then convert bold)
                    const itemHtml = convertBold(escapeHtml(content));
                    htmlParts.push('<li>' + itemHtml + '</li>');
                } else if (trailingTrimmed.trim() === '') {
                    // blank line: acts as paragraph / block separator
                    closeAllLists();
                    closeParagraph();
                } else {
                    // plain paragraph line (not a list item)
                    closeAllLists();
                    if (!inParagraph) {
                        htmlParts.push('<p>');
                        inParagraph = true;
                    } else {
                        // add a space to preserve separation between wrapped lines of same paragraph
                        htmlParts.push(' ');
                    }
                    htmlParts.push(convertBold(escapeHtml(trailingTrimmed)));
                }
            }

            // finish any open tags
            closeAllLists();
            closeParagraph();

            const finalHtml = htmlParts.join('').replace(/\s+<\/li>/g, '</li>'); // tidy

            // Append to element if it exists
            const container = document.getElementById(elementId);
            if (container) {
                container.innerHTML = finalHtml;
            } else {
                // if element not found, still return the HTML so caller can handle it
                console.warn('convertAndAppendHtml: element with id "' + elementId + '" not found. Returning HTML.');
            }

            return finalHtml;
        }
    </script>
</body>

</html>